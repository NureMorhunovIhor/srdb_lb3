<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Drivers List</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css"/>
</head>
<body>
<h1>Drivers List</h1>

<!-- Кнопка для добавления нового водителя -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#driverModal" onclick="clearForm();">
  Add New Driver
</button>

<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead  class="table-dark">
    <tr>
      <th>ID</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Middle Name</th>
      <th>Phone</th>
      <th>City</th>
      <th>Rating</th>
      <th>Driving Experience</th>
      <th>Registration Date</th>
      <th>Email</th>
      <th>Birth Date</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="driver : ${drivers}">
      <td th:text="${driver.id}"></td>
      <td th:text="${driver.firstName}"></td>
      <td th:text="${driver.lastName}"></td>
      <td th:text="${driver.middleName}"></td>
      <td th:text="${driver.phoneNumber}"></td>
      <td th:text="${driver.city}"></td>
      <td th:text="${driver.rating}"></td>
      <td th:text="${driver.drivingExpirience}"></td>
      <td th:text="${driver.registrationDate}"></td>
      <td th:text="${driver.email}"></td>
      <td th:text="${driver.birthDate}"></td>
      <td>
        <a href="#" class="btn btn-warning" th:attr="data-driver-id=${driver.id}" onclick="openModal(this.getAttribute('data-driver-id')); return false;">
          Edit
        </a>
        <a th:href="@{/drivers/delete/{id}(id=${driver.id})}"
           onclick="return confirm('Are you sure you want to delete this driver?');"
           class="btn btn-danger">Delete</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Модальное окно для добавления/редактирования водителя -->
<div class="modal fade" id="driverModal" tabindex="-1" aria-labelledby="driverModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="driverForm" th:action="@{/drivers/save}" method="post">
        <div class="modal-header">
          <h5 class="modal-title" id="driverModalLabel">Add Driver</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="driverId" name="id"/>

          <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" class="form-control" id="firstName" name="firstName" required>
          </div>
          <div class="mb-3">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" class="form-control" id="lastName" name="lastName" required>
          </div>
          <div class="mb-3">
            <label for="middleName" class="form-label">Middle Name</label>
            <input type="text" class="form-control" id="middleName" name="middleName" required>
          </div>
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone</label>
            <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
          </div>
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input type="text" class="form-control" id="city" name="city" required>
          </div>
          <div class="mb-3">
            <label for="rating" class="form-label">Rating</label>
            <input type="number" class="form-control" id="rating" name="rating" min="0" max="5" step="0.1" required>
          </div>
          <div class="mb-3">
            <label for="drivingExpirience" class="form-label">Driving Experience</label>
            <input type="date" class="form-control" id="drivingExpirience" name="drivingExpirience" required>
          </div>
          <div class="mb-3">
            <label for="registrationDate" class="form-label">Registration Date</label>
            <input type="date" class="form-control" id="registrationDate" name="registrationDate" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
          <div class="mb-3">
            <label for="birthDate" class="form-label">Birth Date</label>
            <input type="date" class="form-control" id="birthDate" name="birthDate" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save Driver</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js" defer></script>
<script>
  function openModal(id) {
    fetch(`/drivers/${id}`)
            .then(response => {
              if (!response.ok) throw new Error('Driver not found or server error');
              return response.json();
            })
            .then(driver => {
              document.getElementById('driverId').value = driver.id;
              document.getElementById('firstName').value = driver.firstName;
              document.getElementById('lastName').value = driver.lastName;
              document.getElementById('middleName').value = driver.middleName;
              document.getElementById('phoneNumber').value = driver.phoneNumber;
              document.getElementById('city').value = driver.city;
              document.getElementById('rating').value = driver.rating;
              document.getElementById('drivingExpirience').value = driver.drivingExpirience;
              document.getElementById('registrationDate').value = driver.registrationDate;
              document.getElementById('email').value = driver.email;
              document.getElementById('birthDate').value = driver.birthDate;

              document.getElementById('driverModalLabel').innerText = 'Edit Driver';
              const modal = new bootstrap.Modal(document.getElementById('driverModal'));
              modal.show();
            })
            .catch(error => alert(error.message));
  }

  function clearForm() {
    document.getElementById('driverForm').reset();
    document.getElementById('driverId').value = "";
    document.getElementById('driverModalLabel').innerText = 'Add Driver';
  }
</script>
</body>
</html>
