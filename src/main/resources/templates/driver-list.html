<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Drivers List</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<h1>Drivers List</h1>
<div class="table-container">
  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Middle Name</th>
      <th>Phone</th>
      <th>City</th>
      <th>Rating</th>
      <th>Driving Experience</th>
      <th>Registration Date</th>
      <th>Email</th>
      <th>Birth Date</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="driver : ${drivers}">
      <td th:text="${driver.id}"></td>
      <td th:text="${driver.firstName}"></td>
      <td th:text="${driver.lastName}"></td>
      <td th:text="${driver.middleName}"></td>
      <td th:text="${driver.phoneNumber}"></td>
      <td th:text="${driver.city}"></td>
      <td th:text="${driver.rating}"></td>
      <td th:text="${driver.drivingExpirience}"></td>
      <td th:text="${driver.registrationDate}"></td>
      <td th:text="${driver.email}"></td>
      <td th:text="${driver.birthDate}"></td>
      <td>
        <a href="#" th:onclick="'openModal(' + ${driver.id} + '); return false;'">Edit</a>
        <a th:href="@{/drivers/delete/{id}(id=${driver.id})}"
           onclick="return confirm('Are you sure you want to delete this driver?');">Delete</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Кнопка для добавления нового водителя -->
<button id="addDriverBtn">Add Driver</button>

<!-- Модальное окно для добавления/редактирования водителя -->
<div id="driverModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2 id="modalTitle">Add Driver</h2>
    <form id="driverForm" action="/drivers/save" method="post">
      <input type="hidden" id="driverId" name="id"/>

      <label for="firstName">First Name:</label>
      <input type="text" id="firstName" name="firstName" required><br>

      <label for="lastName">Last Name:</label>
      <input type="text" id="lastName" name="lastName" required><br>

      <label for="middleName">Middle Name:</label>
      <input type="text" id="middleName" name="middleName" required><br>

      <label for="phoneNumber">Phone:</label>
      <input type="text" id="phoneNumber" name="phoneNumber" required><br>

      <label for="city">City:</label>
      <input type="text" id="city" name="city" required><br>

      <label for="rating">Rating:</label>
      <input type="number" id="rating" name="rating" min="0" max="5" step="0.1" required><br>

      <label for="drivingExpirience">Driving Experience:</label>
      <input type="date" id="drivingExpirience" name="drivingExpirience" required><br>

      <label for="registrationDate">Registration Date:</label>
      <input type="date" id="registrationDate" name="registrationDate" required><br>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required><br>

      <label for="birthDate">Birth Date:</label>
      <input type="date" id="birthDate" name="birthDate" required><br>

      <button type="submit">Save Driver</button>
    </form>
  </div>
</div>

<script>
  var modal = document.getElementById("driverModal");
  var addDriverBtn = document.getElementById("addDriverBtn");
  var span = document.getElementsByClassName("close")[0];

  // Открытие модального окна
  addDriverBtn.onclick = function() {
    clearForm(); // Очистка формы перед открытием
    document.getElementById("modalTitle").innerText = "Add Driver"; // Заголовок
    modal.style.display = "block"; // Показываем модальное окно
  }

  // Закрытие модального окна
  span.onclick = function() {
    modal.style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  function openModal(id) {
    fetch(`/drivers/${id}`)
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.json();
            })
            .then(driver => {
              // Заполняем форму данными водителя
              document.getElementById("driverId").value = driver.id;
              document.getElementById("firstName").value = driver.firstName;
              document.getElementById("lastName").value = driver.lastName;
              document.getElementById("middleName").value = driver.middleName;
              document.getElementById("phoneNumber").value = driver.phoneNumber;
              document.getElementById("city").value = driver.city;
              document.getElementById("rating").value = driver.rating;
              document.getElementById("drivingExpirience").value = driver.drivingExpirience;
              document.getElementById("registrationDate").value = driver.registrationDate;
              document.getElementById("email").value = driver.email;
              document.getElementById("birthDate").value = driver.birthDate;

              document.getElementById("modalTitle").innerText = "Edit Driver";
              modal.style.display = "block"; // Показываем модальное окно
            })
            .catch(error => {
              console.error('Error fetching driver:', error); // Обработка ошибок
            });
  }

  function clearForm() {
    document.getElementById("driverId").value = "";
    document.getElementById("firstName").value = "";
    document.getElementById("lastName").value = "";
    document.getElementById("middleName").value = "";
    document.getElementById("phoneNumber").value = "";
    document.getElementById("city").value = "";
    document.getElementById("rating").value = "";
    document.getElementById("drivingExpirience").value = "";
  }
</script>
</body>
</html>