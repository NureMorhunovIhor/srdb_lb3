<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Passengers List</title>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">


</head>
<body>
<h1>Passengers List</h1>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#passengerModal" onclick="clearForm();">
    Add New Passenger
</button>
<div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead  class="table-dark">
        <tr>
            <th>ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Phone Number</th>
            <th>Email</th>
            <th>Birth Date</th>
            <th>Gender</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="passenger : ${passengers}">
            <td th:text="${passenger.id}"></td>
            <td th:text="${passenger.firstName}"></td>
            <td th:text="${passenger.lastName}"></td>
            <td th:text="${passenger.phoneNumber}"></td>
            <td th:text="${passenger.email}"></td>
            <td th:text="${passenger.birthDate}"></td>
            <td th:text="${passenger.gender}"></td>
            <td>
                <a href="#" class="btn btn-primary btn-sm" th:onclick="'openModal(' + ${passenger.id} + '); return false;'">Edit</a> |
                <a class="btn btn-danger btn-sm" th:href="@{/passengers/delete/{id}(id=${passenger.id})}"
                   th:onclick="return confirm('Are you sure you want to delete this passenger?')">Delete</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="modal fade" id="passengerModal" tabindex="-1" aria-labelledby="passengerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="passengerForm" th:action="@{/passengers/save}" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="passengerModalLabel">Create New Passenger</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="passengerId" name="id"/>

                    <div class="mb-3">
                        <label for="firstName" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                    </div>
                    <div class="mb-3">
                        <label for="lastName" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number</label>
                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="birthDate" class="form-label">Birth Date</label>
                        <input type="date" class="form-control" id="birthDate" name="birthDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="gender" class="form-label">Gender</label>
                        <select class="form-select" id="gender" name="gender" required>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Passenger</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js" defer></script>
<script>
    // Получаем элементы модального окна
    var modal = document.getElementById("myModal");
    var btn = document.getElementById("addPassengerBtn");
    var span = document.getElementsByClassName("close")[0];

    // Когда пользователь нажимает на кнопку, открываем модальное окно
    btn.onclick = function() {
        clearForm(); // Очистка формы перед открытием
        document.getElementById("modalTitle").innerText = "Add Passenger"; // Устанавливаем заголовок
        modal.style.display = "block"; // Показываем модальное окно
    }

    // Когда пользователь нажимает на "x", закрываем модальное окно
    span.onclick = function() {
        modal.style.display = "none";
    }

    // Когда пользователь нажимает вне модального окна, закрываем его
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // Функция для открытия модального окна с данными пассажира
    function openModal(id) {
        fetch(`/passengers/edit/${id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(passenger => {
                // Заполняем форму данными пассажира
                document.getElementById("passengerId").value = passenger.id;
                document.getElementById("firstName").value = passenger.firstName;
                document.getElementById("lastName").value = passenger.lastName;
                document.getElementById("phoneNumber").value = passenger.phoneNumber;
                document.getElementById("email").value = passenger.email;
                document.getElementById("birthDate").value = passenger.birthDate;
                document.getElementById("gender").value = passenger.gender;

                document.getElementById('passengerModalLabel').innerText = 'Edit Passenger';
                const passengerModal = new bootstrap.Modal(document.getElementById('passengerModal'));
                passengerModal.show();
            })
            .catch(error => {
                console.error('Error fetching passenger:', error); // Обработка ошибок
            });
    }

    // Функция для очистки формы
    function clearForm() {
        document.getElementById("passengerId").value = "";
        document.getElementById("firstName").value = "";
        document.getElementById("lastName").value = "";
        document.getElementById("phoneNumber").value = "";
        document.getElementById("email").value = "";
        document.getElementById("birthDate").value = "";
        document.getElementById("gender").value = "MALE"; // Устанавливаем значение по умолчанию
    }
</script>
</body>
</html>
